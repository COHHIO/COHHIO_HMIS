---
title: "COVID-19 in Our Populations"
author: "Ohio Balance of State CoC"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(lubridate)
library(knitr)
library(here)

if(exists("dataset") == FALSE) {
  dataset <- "live"
} else {
  dataset <- dataset
}

directory <- case_when(dataset == "live" ~ "data",
                       dataset == "sample" ~ "sampledata",
                       dataset == "yo" ~ "youngstowndata")

if(file.exists(here(paste0(directory, "/covid19.zip")))) {
  unzip(zipfile = here(paste0("./", directory, "/covid19.zip")), 
        exdir = here(paste0("./", directory)))
  
  file.rename(here(paste0(directory, "/", list.files(here(paste0("./", directory)), 
                                                pattern = "(report_)"))),
              here(paste0(directory, "/covid19.csv")))
  
  file.remove(here(paste0(directory, "/covid19.zip")))
}

covid19 <- read_csv(here(paste0(directory, "/covid19.csv")),
                    col_types = "n?cccccccccccccccc") %>%
  mutate(
    COVID19AssessmentDate = mdy(COVID19AssessmentDate)) 
```

## What Data We're Collecting

The Ohio Balance of State CoC is collecting the following data points in relation to clients entering our COordinated Entry process:

1. Risks
    a. Aged 60 or older
    b. History of Respiratory Illness
    c. Chronic Illness
    d. Contact With Confirmed COVID 19 Patient
    e. Contact with person Under Investigation of having COVID-19
2. Symptoms
    a. Primary (1 of these indicates the client may have COVID-19)
        * Cough
        * Shortness of breath or difficulty breathing
    b. Secondary (2+ of these indicates the client may have COVID-19)
        * Fever
        * Headache
        * Chills
        * Repeated shaking with chills
        * Loss of taste or smell
        * Muscle pain
        * Sore throat
3. Diagnosis
    a. Diagnosed
    b. Under Investigation

These data are being collected at entry into our system and can be updated throughout each client's stay in a homeless program. Data entry into HMIS of COVID-19 assessments is optional and the HMIS was only capable of receiving this data as of April 27th, 2020.

As such, this data is VERY preliminary, but will be updated over time. We hope this analysis is helpful, but please send inquiries to hmis@cohhio.org.

## May Have COVID-19 (According to CDC Guidelines)

```{r symptoms}

basic <- covid19 %>%
  as_tibble() %>%
  mutate(
    Symptom1BreathingDifficult = case_when(
      is.na(Symptom1BreathingDifficult) |
        Symptom1BreathingDifficult == "No" ~ 0,
      Symptom1BreathingDifficult == "Yes" ~ 1),
    Symptom1Cough = case_when(
      is.na(Symptom1Cough) |
        Symptom1Cough == "No" ~ 0,
      Symptom1Cough == "Yes" ~ 1),
    Symptom2Chills = case_when(
      is.na(Symptom2Chills) |
        Symptom2Chills == "No" ~ 0,
      Symptom2Chills == "Yes" ~ 1),
    Symptom2Fever = case_when(
      is.na(Symptom2Fever) |
        Symptom2Fever == "No" ~ 0,
      Symptom2Fever == "Yes" ~ 1),
    Symptom2Headache = case_when(
      is.na(Symptom2Headache) |
        Symptom2Headache == "No" ~ 0,
      Symptom2Headache == "Yes" ~ 1),
    Symptom2LostTasteSmell = case_when(
      is.na(Symptom2LostTasteSmell) |
        Symptom2LostTasteSmell == "No" ~ 0,
      Symptom2LostTasteSmell == "Yes" ~ 1),
    Symptom2MusclePain = case_when(
      is.na(Symptom2MusclePain) |
        Symptom2MusclePain == "No" ~ 0,
      Symptom2MusclePain == "Yes" ~ 1),
    Symptom2ShakingChills = case_when(
      is.na(Symptom2ShakingChills) |
        Symptom2ShakingChills == "No" ~ 0,
      Symptom2ShakingChills == "Yes" ~ 1),
    Symptom2SoreThroat = case_when(
      is.na(Symptom2SoreThroat) |
        Symptom2SoreThroat == "No" ~ 0,
      Symptom2SoreThroat == "Yes" ~ 1),
    HealthRiskChronicIllness = case_when(
      is.na(HealthRiskChronicIllness) |
        HealthRiskChronicIllness == "No" ~ 0,
      HealthRiskChronicIllness == "Yes" ~ 1),
    HealthRiskHistoryOfRespiratoryIllness = case_when(
      is.na(HealthRiskHistoryOfRespiratoryIllness) |
        HealthRiskHistoryOfRespiratoryIllness == "No" ~ 0,
      HealthRiskHistoryOfRespiratoryIllness == "Yes" ~ 1),
    HealthRiskOver60 = case_when(
      is.na(HealthRiskOver60) |
        HealthRiskOver60 == "No" ~ 0,
      HealthRiskOver60 == "Yes" ~ 1),
    ContactWithConfirmedCOVID19Patient = case_when(
      is.na(ContactWithConfirmedCOVID19Patient) |
        ContactWithConfirmedCOVID19Patient == "No" ~ 0,
      ContactWithConfirmedCOVID19Patient == "Yes" ~ 1),
    ContactWithUnderCOVID19Investigation = case_when(
      is.na(ContactWithUnderCOVID19Investigation) |
        ContactWithUnderCOVID19Investigation == "No" ~ 0,
      ContactWithUnderCOVID19Investigation == "Yes" ~ 1))

CDCsymptomatic <- basic %>%
  mutate(
    MayHaveCOVID19CDC = (Symptom1BreathingDifficult == 1 |
                           Symptom1Cough == 1) |
      Symptom2Chills + Symptom2SoreThroat + Symptom2Fever +
      Symptom2Headache + Symptom2LostTasteSmell + Symptom2MusclePain +
      Symptom2ShakingChills
    > 1
  ) %>%
  group_by(MayHaveCOVID19CDC) %>%
  summarise(Clients = n())

```

Out of `r nrow(basic)` clients screened for COVID-19, `r CDCsymptomatic$Clients[CDCsymptomatic$MayHaveCOVID19CDC == TRUE]` have symptoms that indicate this client "may have COVID-19". This is defined in the [CDC's guidelines](https://www.cdc.gov/coronavirus/2019-ncov/symptoms-testing/symptoms.html) as having at least one Primary Symptom or at least 2 Secondary Symptoms.

```{r fig1, fig.width=5, fig.asp=.62}

plot_a <- basic %>%
  mutate(
    MayHaveCOVID19CDC = (Symptom1BreathingDifficult == 1 |
                           Symptom1Cough == 1) |
      Symptom2Chills + Symptom2SoreThroat + Symptom2Fever +
      Symptom2Headache + Symptom2LostTasteSmell + Symptom2MusclePain +
      Symptom2ShakingChills
    > 1
  )

plot_a %>%
  ggplot(aes(x = COVID19AssessmentDate, y = MayHaveCOVID19CDC,
             color = MayHaveCOVID19CDC)) +
  scale_color_brewer(palette = "Dark2") +
  geom_jitter(show.legend = FALSE) +
  theme_classic() +
  ggtitle("Clients who May Have COVID-19 \n(according to CDC guidelines)") +
  labs(x = "Date of Assessment", y = "Symptomatic")

```


## Priority for Immediate Non-congregate Housing

```{r risks, echo=FALSE}

risks <- basic %>%
  mutate(
    MayHaveCOVID19CDC = (Symptom1BreathingDifficult == 1 |
                           Symptom1Cough == 1) |
      Symptom2Chills + Symptom2SoreThroat + Symptom2Fever +
      Symptom2Headache + Symptom2LostTasteSmell + Symptom2MusclePain +
      Symptom2ShakingChills > 1,
    HealthRisks = HealthRiskOver60 +
      HealthRiskHistoryOfRespiratoryIllness +
      HealthRiskChronicIllness,
    ProximityRisks =
      ContactWithUnderCOVID19Investigation +
      ContactWithConfirmedCOVID19Patient,
    NumberOfRisks = HealthRisks + ProximityRisks,
    Priority = case_when(
      MayHaveCOVID19CDC == TRUE | NumberOfRisks > 1 ~ "High",
      Symptom2Chills +
        Symptom2SoreThroat +
        Symptom2Fever +
        Symptom2Headache +
        Symptom2LostTasteSmell +
        Symptom2MusclePain +
        Symptom2ShakingChills
      > 0 | NumberOfRisks > 0 ~ "Medium",
      TRUE ~ "Low"
    ),
    Priority = factor(Priority, levels = c("High", "Medium", "Low"))
  )

number_of_risks <- risks %>%
  group_by(NumberOfRisks) %>%
  summarise(Clients = n())

health_risks <- risks %>%
  group_by(HealthRisks) %>%
  summarise(Clients = n())

proximity_risks <- risks %>%
  group_by(ProximityRisks) %>%
  summarise(Clients = n())

priority <- risks %>%
  group_by(Priority) %>%
  summarise(Clients = n())

```

**High Priority** clients are those who either may have COVID-19 based on their symptoms or they have more than 1 risk factor. **Medium Priority** clients are those who have at least one symptom or at least one risk factor. **Low Priority** clients have no risk factors or symptoms related to COVID-19 but may be vulnerable in other ways.

```{r fig2, fig.width=5, fig.asp=.62}

plot_b <- risks %>%
  select(PersonalID, COVID19AssessmentDate, Priority) %>%
  arrange(Priority)

plot_b %>%
  ggplot(aes(x = COVID19AssessmentDate, y = Priority,
             color = Priority)) +
  scale_color_brewer(palette = "Dark2") +
  geom_jitter(show.legend = FALSE) +
  scale_y_discrete(limits = rev(levels(plot_b$Priority))) +
  theme_classic() +
  ggtitle("Priority for Immediate Housing") +
  labs(x = "Date of Assessment", y = "Priority")
```


