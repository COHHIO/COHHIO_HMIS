---
title: "COVID-19 in Our Populations"
author: "Genelle Denzin"
date: "4/30/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(lubridate)
library(knitr)
# library(flexdashboard)
# library(htmlwidgets)
library(here)

if(exists("dataset") == FALSE) {
  dataset <- "live"
} else {
  dataset <- dataset
}

directory <- case_when(dataset == "live" ~ "data",
                       dataset == "sample" ~ "sampledata",
                       dataset == "yo" ~ "youngstowndata")

if(file.exists(here(paste0(directory, "/covid19.zip")))) {
  unzip(zipfile = here(paste0("./", directory, "/covid19.zip")), 
        exdir = here(paste0("./", directory)))
  
  file.rename(here(paste0(directory, "/", list.files(here(paste0("./", directory)), 
                                                pattern = "(report_)"))),
              here(paste0(directory, "/covid19.csv")))
  
  file.remove(here(paste0(directory, "/covid19.zip")))
}

covid19 <- read_csv(here(paste0(directory, "/covid19.csv")),
                    col_types = "n?cccccccccccccccc") %>%
  mutate(
    COVID19AssessmentDate = mdy(COVID19AssessmentDate)) 
```

## What Data We're Collecting

The Ohio Balance of State CoC is collecting the following data points in relation to clients entering our COordinated Entry process:

1. Risks
    a. Aged 60 or older
    b. History of Respiratory Illness
    c. Chronic Illness
    d. Contact With Confirmed COVID 19 Patient
    e. Contact with person Under Investigation of having COVID-19
2. Symptoms
    a. Primary (1 of these indicates the client may have COVID-19)
        * Cough
        * Shortness of breath or difficulty breathing
    b. Secondary (2+ of these indicates the client may have COVID-19)
        * Fever
        * Headache
        * Chills
        * Repeated shaking with chills
        * Loss of taste or smell
        * Muscle pain
        * Sore throat
3. Diagnosis
    a. Diagnosed
    b. Under Investigation

These data are being collected at entry into our system and can be updated throughout each client's stay in a homeless program. Data entry into HMIS of COVID-19 assessments is optional and the HMIS was only capable of receiving this data as of April 27th, 2020.

As such, this data is VERY preliminary, but will be updated over time. We hope this analysis is helpful, but please send inquiries to hmis@cohhio.org.

## Symptoms

```{r symptoms}

basic <- data.frame(lapply(basic, function(x) {
    gsub("Yes", 1, x)
}))

basic <- data.frame(lapply(basic, function(x) {
    gsub("No", 0, x)
}))

basic <- covid19 %>%
  # mutate_if(is.factor, as.integer) %>%
  mutate_at(vars(starts_with(c("Health", "Contact", "Symptom"))),
            ~coalesce(0L))

symptomatic <- basic %>%
  mutate(
    MayHaveCOVID19CDC = (Symptom1BreathingDifficult == 1 | Symptom1Cough == 1) |
      sum(Symptom2Chills + Symptom2SoreThroat + Symptom2Fever +
            Symptom2Headache + Symptom2LostTasteSmell + Symptom2MusclePain +
            Symptom2ShakingChills) > 1) 
# %>%
#   group_by(NumberOfSymptoms) %>%
#   summarise(Clients = n())

```

Out of `r nrow(basic)` clients screened for COVID-19, `r symptomatic$Clients[symptomatic$NumberOfSymptoms == 1]` have 1 COVID-19 symptom and `r symptomatic$Clients[symptomatic$NumberOfSymptoms == 2]` have 2 symptoms.

## Risk Factors

```{r risks, echo=FALSE}

risks <- basic %>%
  mutate(
    NumberOfSymptoms = Cough + BreathingDifficult + SoreThroat + Fever,
    HealthRisks = if_else(`60+` + HistoryOfRespiratoryIllness + ChronicIllness > 0, 1, 0),
    ProximityRisk = if_else(
      ContactWithUnderCOVID19Investigation +
        ContactWithConfirmedCOVID19Patient > 0,
      1,
      0
    ),
    NumberOfRisks = `60+` +
      HistoryOfRespiratoryIllness +
      ChronicIllness +
      ContactWithUnderCOVID19Investigation +
      ContactWithConfirmedCOVID19Patient,
    Priority = case_when(
      NumberOfSymptoms > 2 | NumberOfRisks > 1 ~ "High",
      NumberOfSymptoms > 0 | NumberOfRisks > 0 ~ "Medium",
      TRUE ~ "Low"
      ),
    Priority = factor(Priority, levels = c("High", "Medium", "Low"))
  )

number_of_risks <- risks %>%
  group_by(NumberOfRisks) %>%
  summarise(Clients = n())

health_risks <- risks %>%
  group_by(HealthRisks) %>%
  summarise(Clients = n())

proximity_risks <- risks %>%
  group_by(ProximityRisk) %>%
  summarise(Clients = n())

priority <- risks %>%
  group_by(Priority) %>%
  summarise(Clients = n())

```

`r number_of_risks$Clients[number_of_risks$NumberOfRisks == 1]` clients have one risk factor.
`r number_of_risks$Clients[number_of_risks$NumberOfRisks == 2]` clients have 2 risk factors.
`r number_of_risks$Clients[number_of_risks$NumberOfRisks == 3]` clients have 3 risk factors.

`r priority$Clients[priority$Priority == "High"]` clients are High Priority.
`r priority$Clients[priority$Priority == "Medium"]` clients are Medium Priority.
